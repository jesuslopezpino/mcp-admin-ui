<div class="catalog-container">
  <!-- Breadcrumb Navigation -->
  <app-breadcrumb
    [items]="breadcrumbItems"
    (itemClicked)="onBreadcrumbItemClicked($event)">
  </app-breadcrumb>

  <!-- Header Card -->
  <p-card class="mb-4">
    <ng-template pTemplate="header">
      <div class="flex align-items-center gap-3 p-4">
        <i class="pi pi-cog text-primary text-3xl"></i>
        <div>
          <h2 class="m-0 text-2xl font-semibold text-surface-900">Catálogo de Herramientas</h2>
          <p class="m-0 mt-1 text-surface-600">Explora y ejecuta herramientas MCP disponibles</p>
        </div>
      </div>
    </ng-template>
    
    <ng-template pTemplate="content">
      <div class="flex justify-end gap-2" data-testid="catalog-actions">
        <p-button
          [label]="isLoading ? 'Cargando...' : 'Actualizar'"
          [icon]="isLoading ? 'pi pi-spin pi-spinner' : 'pi pi-refresh'"
          [loading]="isLoading"
          (click)="loadTools()"
          data-testid="refresh-tools-button">
        </p-button>
      </div>
    </ng-template>
  </p-card>

  <!-- Target Selector -->
  <app-target-selector
    [assets]="assets"
    [selectedAssetId]="selectedAssetId"
    (selectedAssetIdChange)="onAssetSelected($event)">
  </app-target-selector>

  <!-- Error Message -->
  @if (error) {
    <p-message 
      severity="error" 
      [text]="error" 
      [closable]="false"
      class="mb-4">
    </p-message>
  }

  <!-- Loading Message -->
  @if (isLoading && tools.length === 0) {
    <p-card>
      <div class="flex flex-col align-items-center justify-center p-8 gap-4">
        <p-progressSpinner [style]="{ width: '50px', height: '50px' }"></p-progressSpinner>
        <p class="text-surface-600 m-0">Cargando herramientas...</p>
      </div>
    </p-card>
  }

  <!-- Categories View -->
  @if (currentView === 'categories' && !isLoading && tools.length > 0) {
    <app-category-grid
      [categories]="categories"
      [categorizedTools]="categorizedTools"
      (categorySelected)="onCategorySelected($event)">
    </app-category-grid>
  }

  <!-- Category Tools View -->
  @if (currentView === 'tools' && selectedCategory) {
    <app-category-tools
      [categoryId]="selectedCategory"
      [tools]="getCurrentCategoryTools()"
      (toolSelected)="onToolSelected($event)"
      (backToCategories)="onBackToCategories()">
    </app-category-tools>
  }

  <!-- Empty State -->
  @if (!isLoading && tools.length === 0 && !error) {
    <p-card>
      <div class="flex flex-col align-items-center justify-center p-8 gap-4 text-center">
        <i class="pi pi-cog text-6xl text-surface-400"></i>
        <h3 class="text-xl font-semibold text-surface-900 m-0">No hay herramientas disponibles</h3>
        <p class="text-surface-600 m-0">No se encontraron herramientas en el catálogo. Verifica que el backend esté ejecutándose correctamente.</p>
        <p-button
          label="Intentar de nuevo"
          icon="pi pi-refresh"
          (click)="loadTools()"
          class="mt-2">
        </p-button>
      </div>
    </p-card>
  }

  <!-- Tool Execution Modal -->
  @if (showModal) {
    <app-run-tool-modal
      [tool]="selectedTool"
      [assetId]="selectedAssetId"
      (close)="onModalClose()"
      (result)="onToolExecute($event)">
    </app-run-tool-modal>
  }
</div>
