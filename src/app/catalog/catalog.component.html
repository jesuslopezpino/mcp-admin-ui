<div class="catalog-container">
  <!-- Breadcrumb Navigation -->
  <app-breadcrumb
    [items]="breadcrumbItems"
    (itemClicked)="onBreadcrumbItemClicked($event)">
  </app-breadcrumb>

  <!-- Header -->
  <div class="header" data-testid="catalog-header">
    <h2>🛠️ Catálogo de Herramientas</h2>
    <p>Explora y ejecuta herramientas MCP disponibles</p>
  </div>

  <!-- Actions Bar -->
  <div class="actions-bar" data-testid="catalog-actions">
    <button
      class="btn btn-primary"
      (click)="loadTools()"
      [disabled]="isLoading"
      data-testid="refresh-tools-button">
      @if (isLoading) {
        <span>⏳</span>
      }
      @if (!isLoading) {
        <span>🔄</span>
      }
      {{ isLoading ? 'Cargando...' : 'Actualizar' }}
    </button>
  </div>

  <!-- Target Selector -->
  <app-target-selector
    [assets]="assets"
    [selectedAssetId]="selectedAssetId"
    (selectedAssetIdChange)="onAssetSelected($event)">
  </app-target-selector>

  <!-- Error Message -->
  @if (error) {
    <div class="error-message">
      <div class="error-content">
        <span class="error-icon">⚠️</span>
        {{ error }}
      </div>
    </div>
  }

  <!-- Loading Message -->
  @if (isLoading && tools.length === 0) {
    <div class="loading-message">
      <div class="loading-content">
        <span class="loading-icon">⏳</span>
        Cargando herramientas...
      </div>
    </div>
  }

  <!-- Categories View -->
  @if (currentView === 'categories' && !isLoading && tools.length > 0) {
    <app-category-grid
      [categories]="categories"
      [categorizedTools]="categorizedTools"
      (categorySelected)="onCategorySelected($event)">
    </app-category-grid>
  }

  <!-- Category Tools View -->
  @if (currentView === 'tools' && selectedCategory) {
    <app-category-tools
      [categoryId]="selectedCategory"
      [tools]="getCurrentCategoryTools()"
      (toolSelected)="onToolSelected($event)"
      (backToCategories)="onBackToCategories()">
    </app-category-tools>
  }

  <!-- Empty State -->
  @if (!isLoading && tools.length === 0 && !error) {
    <div class="empty-state">
      <div class="empty-content">
        <span class="empty-icon">🔧</span>
        <h3>No hay herramientas disponibles</h3>
        <p>No se encontraron herramientas en el catálogo. Verifica que el backend esté ejecutándose correctamente.</p>
        <button class="btn btn-primary" (click)="loadTools()">
          🔄 Intentar de nuevo
        </button>
      </div>
    </div>
  }

  <!-- Tool Execution Modal -->
  @if (showModal) {
    <app-run-tool-modal
      [tool]="selectedTool"
      [assetId]="selectedAssetId"
      (close)="onModalClose()"
      (result)="onToolExecute($event)">
    </app-run-tool-modal>
  }
</div>
