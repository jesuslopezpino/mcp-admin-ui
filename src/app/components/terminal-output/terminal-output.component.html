<div class="terminal-container">
  <div class="terminal-header">
    <div class="terminal-info-row">
      @if (targetHostname || targetIp) {
        <div class="target-info">
          <span class="info-label">🎯 Destino:</span>
          <span class="info-value">{{ getTargetDisplayName() }}</span>
        </div>
      }
      @if (commandName) {
        <div class="command-info">
          <span class="info-label">🔧 Comando:</span>
          <span class="info-value">{{ getCommandDisplayName() }}</span>
        </div>
      }
      <div class="terminal-status" [style.color]="getStatusColor()">
        <span class="status-icon">{{ getStatusIcon() }}</span>
        {{ status }} (Exit Code: {{ exitCode }})
      </div>
    </div>
  </div>

  <div class="terminal-body" data-testid="run-modal-stdout">
    <pre class="terminal-output">{{ getDisplayOutput() }}</pre>
    @if (isTruncated && !showFullOutput) {
      <div class="truncate-notice">
        <button class="btn-expand" (click)="toggleOutput()" data-testid="terminal-expand">
          👁️ Ver todo ({{formattedOutput.length}} caracteres)
        </button>
      </div>
    }
    @if (isTruncated && showFullOutput) {
      <div class="truncate-notice">
        <button class="btn-collapse" (click)="toggleOutput()">
          🔼 Ocultar
        </button>
      </div>
    }
  </div>

  <div class="terminal-footer">
    <div class="terminal-actions">
      <button class="btn-copy" (click)="copyToClipboard()" title="Copiar al portapapeles" data-testid="terminal-output-copy">
        📋 Copiar
      </button>
      <button class="btn-download" (click)="downloadOutput()" title="Descargar como archivo" data-testid="terminal-output-download">
        💾 Descargar
      </button>
      <button class="btn-fullscreen" (click)="toggleFullscreen()" title="Ver en pantalla completa">
        🔍 Pantalla completa
      </button>
    </div>
  </div>
</div>

<!-- Fullscreen Modal -->
@if (isFullscreen) {
  <div class="fullscreen-overlay" (click)="closeFullscreen()">
    <div class="fullscreen-terminal" (click)="$event.stopPropagation()">
      <div class="fullscreen-header">
        <div class="fullscreen-info-row">
          @if (targetHostname || targetIp) {
            <div class="target-info">
              <span class="info-label">🎯 Destino:</span>
              <span class="info-value">{{ getTargetDisplayName() }}</span>
            </div>
          }
          @if (commandName) {
            <div class="command-info">
              <span class="info-label">🔧 Comando:</span>
              <span class="info-value">{{ getCommandDisplayName() }}</span>
            </div>
          }
          <div class="terminal-status" [style.color]="getStatusColor()">
            <span class="status-icon">{{ getStatusIcon() }}</span>
            {{ status }} (Exit Code: {{ exitCode }})
          </div>
        </div>
        <button class="btn-close-fullscreen" (click)="closeFullscreen()" title="Close fullscreen">
          ✕
        </button>
      </div>
      <div class="fullscreen-body">
        <pre class="terminal-output fullscreen">{{ formattedOutput }}</pre>
      </div>
      <div class="fullscreen-footer">
        <div class="fullscreen-actions">
          <button class="btn-copy" (click)="copyToClipboard()" title="Copy to clipboard">
            📋 Copy
          </button>
          <button class="btn-download" (click)="downloadOutput()" title="Download output">
            💾 Download
          </button>
          <button class="btn-close-fullscreen" (click)="closeFullscreen()" title="Close fullscreen">
            ✕ Close
          </button>
        </div>
      </div>
    </div>
  </div>
}
