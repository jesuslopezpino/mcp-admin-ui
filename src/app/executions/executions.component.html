<div class="executions-container">
  <div class="page-header">
    <h1>üìä Ejecuciones</h1>
    <p class="page-description">Consulta el estado y resultados de ejecuciones por ID</p>
  </div>

  <!-- Lookup Form -->
  <div class="lookup-section">
    <form [formGroup]="lookupForm" (ngSubmit)="onLookup()" class="lookup-form" data-testid="executions-lookup">
      <div class="form-group">
        <label for="executionId" class="form-label">
          ID de Ejecuci√≥n
          <span class="required-mark">*</span>
        </label>
        <input 
          type="text" 
          id="executionId"
          formControlName="executionId"
          class="form-input"
          placeholder="ej: 12345678-1234-1234-1234-123456789abc"
          [class.error]="lookupForm.get('executionId')?.invalid && lookupForm.get('executionId')?.touched"
          data-testid="execution-id-input">
        
        <div *ngIf="lookupForm.get('executionId')?.invalid && lookupForm.get('executionId')?.touched" 
             class="error-message">
          <span *ngIf="lookupForm.get('executionId')?.errors?.['required']">ID de ejecuci√≥n requerido</span>
          <span *ngIf="lookupForm.get('executionId')?.errors?.['pattern']">Formato UUID inv√°lido</span>
        </div>
      </div>
      
      <button type="submit" 
              class="btn btn-primary"
              [disabled]="lookupForm.invalid || isLoading"
              data-testid="lookup-button">
        <span *ngIf="isLoading" class="spinner">‚è≥</span>
        <span *ngIf="!isLoading">üîç</span>
        {{ isLoading ? 'Buscando...' : 'Buscar Ejecuci√≥n' }}
      </button>
    </form>
  </div>

  <!-- Execution Details -->
  <div class="execution-details" *ngIf="execution" data-testid="execution-details">
    <!-- Result Header -->
    <div class="result-header">
      <h3 class="result-title">
        <span class="exec-status" 
              [class.exec-status--success]="execution.status === 'SUCCESS'"
              [class.exec-status--failed]="execution.status === 'FAILED'"
              [class.exec-status--error]="execution.status === 'ERROR'"
              data-testid="execution-status">
          {{ getStatusIcon(execution.status) }} {{ execution.status }}
        </span>
        <span class="execution-id">ID: {{ execution.id.substring(0, 8) }}...</span>
      </h3>
      
      <!-- Exit Code and Duration -->
      <div class="result-meta" *ngIf="execution.exitCode !== undefined || getExecutionDuration()">
        <span *ngIf="execution.exitCode !== undefined" 
              class="exit-code"
              data-testid="execution-exitcode">
          Exit Code: {{ execution.exitCode }}
        </span>
        <span *ngIf="getExecutionDuration()" 
              class="duration"
              data-testid="execution-duration">
          Duraci√≥n: {{ getExecutionDuration() }}
        </span>
      </div>
    </div>

    <!-- Error Details (only for FAILED or ERROR) -->
    <div class="exec-error__section" 
         *ngIf="(execution.status === 'FAILED' || execution.status === 'ERROR') && (execution.errorCode || execution.failureStage)">
      <h4>üîç Detalles del Error</h4>
      <div class="error-details">
        <div *ngIf="execution.failureStage" class="error-item">
          <span class="error-label">Etapa:</span>
          <span class="failure-stage" data-testid="execution-failure-stage">{{ execution.failureStage }}</span>
        </div>
        <div *ngIf="execution.errorCode" class="error-item">
          <span class="error-label">C√≥digo:</span>
          <span class="error-code" data-testid="execution-error-code">{{ execution.errorCode }}</span>
        </div>
        <div *ngIf="execution.errorReason" class="error-item">
          <span class="error-label">Motivo:</span>
          <span class="error-reason" data-testid="execution-error-reason">{{ execution.errorReason }}</span>
        </div>
      </div>
    </div>

    <!-- JSON Response Block (only if responseJson exists) -->
    <div class="exec-json__section" *ngIf="execution.responseJson" data-testid="execution-response-json">
      <h4>üìÑ Respuesta JSON</h4>
      <div class="json-container">
        <pre class="json-content">{{ getPrettyJson(execution.responseJson) }}</pre>
        <div class="json-actions">
          <button class="btn btn-sm btn-secondary" 
                  (click)="copyJson(execution.responseJson)"
                  data-testid="execution-json-copy">
            üìã Copiar JSON
          </button>
          <button class="btn btn-sm btn-secondary" 
                  (click)="downloadJson(execution.responseJson, execution.id)"
                  data-testid="execution-json-download">
            üíæ Descargar JSON
          </button>
        </div>
      </div>
    </div>

    <!-- Terminal Output -->
    <div class="terminal-block">
      <h4>üíª Salida de Terminal</h4>
      <div class="terminal-output">
        <div *ngIf="execution.stdout" class="stdout-section">
          <h5>Salida est√°ndar (stdout):</h5>
          <pre class="terminal-content">{{ execution.stdout }}</pre>
        </div>
        <div *ngIf="execution.stderr" class="stderr-section">
          <h5>Error est√°ndar (stderr):</h5>
          <pre class="terminal-content stderr">{{ execution.stderr }}</pre>
        </div>
        <div *ngIf="!execution.stdout && !execution.stderr" class="no-output">
          <p>No hay salida disponible</p>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results Message -->
  <div class="no-results" *ngIf="!execution && !isLoading">
    <div class="no-results-content">
      <h3>üîç Buscar Ejecuci√≥n</h3>
      <p>Introduce un ID de ejecuci√≥n para ver sus detalles y resultados.</p>
      <div class="help-text">
        <p><strong>Tip:</strong> Los IDs de ejecuci√≥n son UUIDs que se generan cuando se inicia una ejecuci√≥n.</p>
      </div>
    </div>
  </div>
</div>
