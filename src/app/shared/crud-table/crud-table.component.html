<!-- Toolbar - Sakai Style -->
<p-toolbar styleClass="mb-6">
  <ng-template #start>
    @if (showCreateButton) {
      <p-button 
        [label]="createButtonLabel" 
        [icon]="createButtonIcon" 
        (click)="onCreateClick()"
        severity="secondary" 
        class="mr-2"
        data-testid="create-button">
      </p-button>
    }
    @if (showDeleteButton) {
      <p-button 
        severity="secondary" 
        label="Delete" 
        icon="pi pi-trash" 
        [outlined]="true" 
        (click)="onDeleteSelectedClick()" 
        [disabled]="!selectedItems || !selectedItems.length">
      </p-button>
    }
  </ng-template>

  <ng-template #end>
    @if (showExportButton) {
      <p-button 
        label="Export" 
        icon="pi pi-upload" 
        severity="secondary" 
        (click)="onExportClick()">
      </p-button>
    }
  </ng-template>
</p-toolbar>

<!-- Table - Sakai Style -->
<p-table
  [value]="data" 
  [loading]="loading"
  [rows]="rows"
  [columns]="columns"
  [paginator]="showPagination"
  [globalFilterFields]="filterFields"
  [tableStyle]="{ 'min-width': '75rem' }"
  [(selection)]="selectedItems"
  [rowHover]="true"
  dataKey="id"
  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} {{ title.toLowerCase() }}"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="rowsPerPageOptions">
  
  <ng-template #caption>
    <div class="flex items-center justify-between">
      <h5 class="m-0">Manage {{ title }}</h5>
      <p-iconfield>
        <p-inputicon styleClass="pi pi-search" />
        <input pInputText type="text" (input)="onGlobalFilterChangeEvent($event)" [placeholder]="'Search ' + title.toLowerCase() + '...'" />
      </p-iconfield>
    </div>
  </ng-template>
  
  <ng-template #header>
    <tr>
      @if (showSelection) {
        <th style="width: 3rem">
          <p-tableHeaderCheckbox />
        </th>
      }
      @for (column of columns; track column.field) {
        <th 
          [pSortableColumn]="column.sortable ? column.field : undefined" 
          [style.width]="column.width">
          {{ column.header }}
          @if (column.sortable) {
            <p-sortIcon [field]="column.field" />
          }
        </th>
      }
    </tr>
  </ng-template>

  <ng-template #body let-item>
    <tr>
      @if (showSelection) {
        <td style="width: 3rem">
          <p-tableCheckbox [value]="item" />
        </td>
      }
      @for (column of columns; track column.field) {
        <td>
          @switch (column.type) {
            @case ('date') {
              <span>{{ formatDate(item[column.field]) }}</span>
            }
            @case ('status') {
              <p-tag 
                [value]="getStatusLabel(item[column.field])" 
                [severity]="getSeverity(item[column.field])">
              </p-tag>
            }
            @case ('actions') {
              <div class="action-buttons">
                @for (action of actions; track action.label) {
                  @if (shouldShowAction(action, item)) {
                    <p-button 
                      [icon]="action.icon" 
                      [outlined]="true" 
                      [rounded]="true"
                      size="small"
                      [severity]="action.severity"
                      (click)="onActionClick(action, item)"
                      [pTooltip]="action.tooltip"
                      class="mr-2">
                    </p-button>
                  }
                }
              </div>
            }
            @default {
              <span>{{ item[column.field] }}</span>
            }
          }
        </td>
      }
    </tr>
  </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td [colSpan]="columns.length + (showSelection ? 1 : 0)" class="empty-message">
          <div class="empty-content">
            <i class="pi pi-inbox empty-icon"></i>
            <span class="empty-title">No {{ title.toLowerCase() }} found</span>
            <span class="empty-subtitle">Create your first {{ title.toLowerCase().slice(0, -1) }} to get started!</span>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>

<!-- Global Components -->
<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
